---
title: "OST analysis"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: scroll
    theme: sandstone
    
---

```{r setup, include=FALSE}
library(flexdashboard)
library(tidyverse)
library(spotifyr)
library(grid)
library(gtable)
library(ggrepel)
library(dplyr)

#for Chromo
library(compmus)

library(vembedr)

# album 2KG4ZPNd045dzwHGWZQq2X
# bss 1amowbJ9HHFFSFdg2ubM7G
# 10cm 7nxoUuqcsDfv3PsPGeciWy
# Heize 69Bx1c9Hzv7IZGkLyFCeMw
# Crush 0UaaFmF3xUwMjnuAHBq7qL
# isaac 0sbFehFR6z0DbthqkJivpa
```

```{r}
# get data
album <- get_playlist_audio_features("", "2KG4ZPNd045dzwHGWZQq2X")
bss <-get_track_audio_analysis("1amowbJ9HHFFSFdg2ubM7G")
s_1 <- "1amowbJ9HHFFSFdg2ubM7G"
s_2 <- "7nxoUuqcsDfv3PsPGeciWy"
s_3 <- "69Bx1c9Hzv7IZGkLyFCeMw"
s_4 <- "0UaaFmF3xUwMjnuAHBq7qL"
s_5 <- "0sbFehFR6z0DbthqkJivpa"

url_1 <- "https://www.youtube.com/watch?v=ucpb4BYNJ6s"
url_2 <- "https://www.youtube.com/watch?v=_j0BOGdmh38"
url_3 <- "https://www.youtube.com/watch?v=jRRCWFLAO6k"
url_4 <- "https://www.youtube.com/watch?v=Z4qVfCi_lUI"
url_5 <- "https://www.youtube.com/watch?v=jbjZ9kcmvD0" 

```

```{r}
# My own data-frame of OST in episodes
episode <- c(1,1,1,1,1,2,2,3,3,3,3,3,4,4,5,5,5,6,6,6,6,6,7,7,8,8)
start <- c(74, 480, 580, 1880, 4446, 4058, 5127, 337, 1607, 1975, 2535, 4730, 182, 5018, 130, 2235, 4531, 355, 1555, 3065, 4539, 4779, 263, 4655, 297, 5090)
end <- c(139, 546, 661, 1960, 4520, 4128, 5250, 398, 1680, 2010, 2600, 4840, 236, 5142, 195, 2300, 4674, 440, 1641, 3128, 4600, 4877, 500, 4763, 388, 5122)

OST <- c("The reason of my smiles", "Tell me it's not a dream", "The reason of my smiles", "Hold me back", "The reason of my smiles", "The reason of my smiles", "The reason of my smiles" ,  "Love you with all my heart", "The reason of my smiles", "Tell me it's not a dream", "Tell me it's not a dream", "Tell me it's not a dream", "Tell me it's not a dream", "Hold me back", "Love you with all my heart", "Hold me back", "Hold me back", "Love you with all my heart", "Love you with all my heart", "Tell me it's not a dream", "Fallin'", "Hold me back", "Fallin'", "Fallin'", "The reason of my smiles", "Fallin'")

artist <- c("BSS", "10CM", "BSS", "Heize", "BSS", "BSS", "BSS", "Crush", "BSS", "10CM", "10CM", "10CM", "10CM", "Heize", "Crush", "Heize", "Heize", "Crush", "Crush", "10CM", "Isaac Hong", "Heize", "Isaac Hong", "Isaac Hong", "BSS", "Isaac Hong" )

num_valence <- c(1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0.5, 0.5, 0, 0, 0, 0, 0.5, 0.5, 1, 1, 0, 0, 0)
Valence <- c("Happy", "Happy", "Happy", "Sad", "Happy", "Happy", "Happy", "Happy", "Happy" ,"Happy" ,"Happy","Happy","Happy", "Conflicted", "Conflicted", "Sad", "Sad", "Sad", "Conflicted", "Conflicted", "Conflicted", "Happy", "Happy", "Sad", "Sad", "Sad")
context <- c()

my_df <- data.frame(start, end, episode,  OST, artist, Valence)
```

```{r}
title_1 <- "The reason of my smiles"
title_2 <- "Tell me it's not a dream"
title_3 <- "Hold me back"
title_4 <- "Love you with all my heart"
title_5 <- "Fallin'"
```
# Corpus

## Column {style="min-width:600px" }

### Corpus description

My corpus consist of the Orginal Sound Tracks(OSTs) of a Korean-drama : Queen of tears. The K-drama was just released in February and has me hooked! I've been continuously listening to the OSTs ever since the first episode.

The OSTs are specifically chosen and made to match the melodramatic experience of this particular K-drama. That's the reason why the OSTs play an essential role in conveying the emotions to the viewer. It builds a form of familiarity to anticipate certain developments throughout the story. This effect of music on the viewer piqued my interest in using MIR to find correlations between the application of the tracks and the sensitive scenes in the drama.

The corpus consist only of 5 track. This is because the drama hasn't ended yet, so the focus is on the 8 released episodes. 

### Drama context
The K-drama is about a married couple, that lost all love for each other. The middle-class husband married into a mega rich household. He suffocates in his life as a husband and as the problem solver for his rich and dumb in-laws. While going through the hardships he finds himself in a position of wanting to divorce the love of his life. When he was ready to initiate the divorcement, he finds out his wife got brain cancer and will die in 3 months. This probed an interesting change in their relationship dynamics. In short, they rediscover their long lost love again through melodramatic detours which fills the drama.


### Structural significance

In total there are 26 instances of the use of released OSTs. There are recurring patterns in the distribution, when looking at the sequential usage. As you can see in the histogram below, the track "The reason of my smiles" is concentrated in the first 3 episodes, marking the first phase of the drama. "Hold me back" is concentrated in the 4-6, marking the second phase and "Fallin'" 6-8 the third phase. The OSTs do actually play a significant role in the structure of the drama. 

- phase 1 : The change of heart
- phase 2 : The truth of divorcement resurfaces
- phase 3 : Divorcement

#### Distrubution Histogram

```{r, echo=FALSE, fig.width=5, fig.height=4}
ggplot(my_df, aes(x=episode, fill=OST)) +
  geom_histogram(bins=15) +
  labs(title = "Track distribution over the episodes",
       x = "Episodes",
       y = "Count") 
```


### Semantic significance

In the histogram below, you can see that the phases are also apparent when observing the conveyed emotions for each episode. The emotional connotations and the phases are highly correlated. In a way, the tracks are used for the emotional transition through phases. This transition is not only structural, but also semantic. A track accumulates more and more contextual meaning with each consecutive use. Not only consolidating the structure, but also integrate meaningful aspects into a track. 

The valence of "Conflicted" means uncertain whether the use is happy or sad.



#### Distrubution Histogram

```{r, echo=FALSE, fig.width=5, fig.height=4}

epi <- my_df %>% group_by(Valence)

ggplot(epi, aes(x=episode, fill=Valence)) +
  geom_histogram(bins=15) +
  labs(title = "Track distribution over the episodes",
       x = "Episodes",
       y = "Count") +
  scale_fill_manual(values = c("#73C6B6", "#229954", "#3498DB" ))
```


## Column {style="min-width:600px" .tabset .tabset-fade}

### The reason of my smiles

#### Track video

```{r, echo=FALSE, fig.width=5, fig.height=4}
embed_url(url_1)
```

#### Desciptions

The reason of my smiles is the main OST in the K-drama. The track is used for promoting and mainly heartwarming scenes, i.e. a wedding scene. It's got the typical love song feel to it, because of adoring lyrics, breathy voice and slow pace. 


#### Distribution

```{r, echo=FALSE, fig.width=5, fig.height=4}
bss_epi <- my_df %>% group_by(OST) %>% filter(artist  == "BSS")

ggplot(bss_epi, aes(x=episode, fill=Valence)) +
  geom_histogram(bins=15) +
  labs(title = "Valence distribution over episodes",
       x = "Episodes",
       y = "Count") +
   scale_fill_manual(values = c("#229954", "#3498DB"))
```

As stated before the track is primarily used for heartwarming moments. This is especially true in the first 3 episodes, which is phase 1. Phase 1 contains the most happy scenes, because phase 1 contains the memories prior to the marriage. With each episode, the drama exposes past regrets. The story-line gradually becomes more sad. This evident in the decrease occurrence of the track. 

On the other hand, the track is surprisingly used for sad scenes in episode 8. At the first glance it is visible that a clear change happened. However I think the prior positive connotation of the track is used in a sad scene to bring out confusion. An interesting conflicting dance between happiness and sadness.  

#### No correlation between segment and valence

```{r, echo=FALSE, fig.width=5, fig.height=4}

new_bss_epi <- bss_epi %>% mutate(segment = case_when(end < 1500 ~ 'Begin',
                                                    end < 3400 ~ 'Central',
                                                    end < 6000 ~ 'End'))

ggplot(new_bss_epi, aes(segment)) + geom_bar(aes(fill=Valence)) +
  labs(title = "Episode's segment and valence",
       x = "Segment",
       y = "Count") +
   scale_fill_manual(values = c("#229954", "#3498DB"))


```

The 1.5 hour of an episode is split into 3 segments : Begin, Central and End. Due to the occurrence of a pattern over the whole episode, there must exist a pattern in the episode itself. Denoting where most likely the happy/sad moments are. Even so, in this case there doesn't seem to be a correlation. 


### Tell me it's not a dream

#### Track video

```{r}
embed_url(url_2) 

```

#### Description
Tell me it's not a dream is sung by 10CM. The forte of his singing lies in the delivery of melancholic melodies. The eerie, but yet soft overtones of his voice creates a trance of unintentionally daydreaming over past experiences. The track is mainly used with romantical thoughts and moments. For example, a kiss scene or a love confession scene. The song resonates a feeling of a safety and reassurance, when hindered by a fear of action. 


#### Distribution
```{r, echo=FALSE, fig.width=5, fig.height=4}
cm_epi <- my_df %>% group_by(OST) %>% filter(artist  == "10CM")

ggplot(cm_epi, aes(x=episode, fill=Valence)) +
  geom_histogram(bins=10) +
  labs(title = "Valence distribution over episodes",
       x = "Episodes",
       y = "Count") +
   scale_fill_manual(values = c("#73C6B6", "#229954"))
```

The track is generally very positive. There is also no evidence in a structural dependency of the usage of the track and the valence. Just as with the track "The reason of my smiles", is the happy ranking suddenly changing in the later episodes. The remarkable thing here is that the ranking is not sad, but conflicted, which can mean that the song itself is perceived more optimistically. 

Furthermore, the track is largely used in the 3e episode. Since this episode belongs to phase 1, meaning mostly positive scenes and with the obtained knowledge from the previous track "The reason of my smiles" distribution. A conclusion can be made that this track is used for transitioning the previous lovely emotions to another one, that feels new and surprising. In my opinion, this track sounds more sad than the previous track. This may be a sign of a descending progression for the protagonists. 

#### No correlation between segment and valence

```{r, echo=FALSE, fig.width=5, fig.height=4}

new_cm_epi <- cm_epi %>% mutate(segment = case_when(end < 1500 ~ 'Begin',
                                                    end < 3400 ~ 'Central',
                                                    end < 6000 ~ 'End'))

ggplot(new_cm_epi, aes(segment)) + geom_bar(aes(fill = Valence)) +
  labs(title = "Episode's segment and valence",
       x = "Segment",
       y = "Count") +
   scale_fill_manual(values = c("#73C6B6", "#229954"))


```

Again there seems to be no clear correlation. However compared to the previous track "The reason of my smiles", this barplot seems to be the inverse.



### Hold me back

#### Track video

```{r}
embed_url(url_3)
```

#### Desciptions
Hold me back sung by Heize. The first and only female singer in the album. She's known to sing sad OSTs for dramas. This is due to the higher overtones creating an intense and heartbreaking timbre. The track is chiefly used for extremely sad scenes, such as being deserted by the love of your life, when fighting cancer together. The intense suffering is transparent throughout the track, such as in the lyrics, which portrays a break-up, where one desperately longs for the significant other with no avail.   

#### Distribution

```{r, echo=FALSE, fig.width=5, fig.height=4}
heize_epi <- my_df %>% group_by(OST) %>% filter(artist  == "Heize")

ggplot(heize_epi, aes(x=episode, fill=Valence)) +
  geom_histogram(bins=10) +
  labs(title = "Valence distribution over episodes",
       x = "Episodes",
       y = "Count") +
  scale_fill_manual(values = c("#73C6B6", "#229954", "#3498DB" ))
```

In phase 1 and 2 the perceived valence is negative. This track is the only instance of a sad track in phase 1, reinforcing the idea that phase 1 is the most positive. Unlike the previous tracks, this track is classified in all categories : Conflicted, Happy and Sad. This may be due to the change in the direction of the drama. Starting from phase 2 the scenes become very dubious and unclear of what the right course of action is for the protagonists. It feels like a hail of bullets. Dodging a few bullets has no effect if one gets severely injured. This characteristic may be the cause for the employment of the track. Even in happiness there still lingers an undertone of extreme pain. 

#### Correlation between segment and valence 

```{r, echo=FALSE, fig.width=5, fig.height=4}

new_heize_epi <- heize_epi %>% mutate(segment = case_when(end < 1500 ~ 'Begin',
                                                    end < 3400 ~ 'Central',
                                                    end < 6000 ~ 'End'))

ggplot(new_heize_epi, aes(segment)) + geom_bar(aes(fill = Valence)) +
  labs(title = "Episode's segment and valence",
       x = "Segment",
       y = "Count") +
   scale_fill_manual(values = c("#73C6B6", "#229954", "#3498DB"))

```

The segments point to an exclusive usages in the middle and end of an episode. This explains the cliffhanging experience, where the direction for the next episode is unclear. The track is used for all valences to unsettle the viewer during and after an episode. It's obvious that the beginning of an episode is to ascertain one's fickle believe and the middle and end for building up the next episode/plot. In the end, this is still a conjecture. No clear evidence of an actual correlation.


### Love you with all my heart

#### Track video

```{r}
embed_url(url_4)
```

#### Desciptions
Love you with all my heart is sung by Crush. Compared to all the other male singers, Crush's vocal range is wider. His transition from lower to higher pitches is undoubtedly, what makes this track's mood feel a bit more sombre. The contrast of louder and soft singing, emphasizes the dreary vibe. Additionally, the lyrics are also full of regret and a relentless desire of loving someone, who is not there anymore. The song is partly about being honest about one's true feeling. This can be interpreted in the context of the drama as opening up even though it may be too late, which is still relatively positive. On the other hand, the regret is perceived as negative, unable to overcome past mistakes.  


#### Distribution
```{r, echo=FALSE, fig.width=5, fig.height=4}
crush_epi <- my_df %>% group_by(OST) %>% filter(artist  == "Crush")

ggplot(crush_epi, aes(x=episode, fill=Valence)) +
  geom_histogram(bins=10) +
  labs(title = "Valence distribution over episodes",
       x = "Episodes",
       y = "Count") +
  scale_fill_manual(values = c("#73C6B6", "#229954", "#3498DB" ))
```

In general the valence is negative, which coincides with the trend of phase 2 and 3 getting more sad. The closer we get to the "last" episode the less frequent the latest songs appear. 

Even though in episode 3 the track is classified as happy, the scene was an memory of the first promise made between the couple. The promise was that the husband will always take care of her. This scene is primarily happy, but the reason of the flashback was because the wife was almost killed by a boar. This resulted in a reminiscence of past glory. Through her inner dialogue she appears lost, unknowing what she actually feels for her husband. The classification doesn't represent the whole context. This may be the reaason why not all instances of the track are sad. 



####  Correlation between segment and valence 

```{r, echo=FALSE, fig.width=5, fig.height=4}

new_crush_epi <- crush_epi %>% mutate(segment = case_when(end < 1500 ~ 'Begin',
                                                    end < 3400 ~ 'Central',
                                                    end < 6000 ~ 'End'))

ggplot(new_crush_epi, aes(segment)) + geom_bar(aes(fill = Valence)) +
  labs(title = "Episode's segment and valence",
       x = "Segment",
       y = "Count") +
   scale_fill_manual(values = c("#73C6B6", "#229954", "#3498DB"))

```

The segments are concentrated in the begin and middle part of an episode. This can be interpreted as the hopeful nature of the track, where the honest feeling of loving someone brings peace. This hopeful nature is suited for a conclusion of the previous episodes cliffhanger. 


### Fallin'

#### Track video

```{r}
embed_url(url_5)
```

#### Desciptions
Fallin' is sung by Isaac Hong. The track is sung in a deeper voice than the other tracks. The tracks gives off a holy atmosphere, as falling in grace. The lyrics are about falling deeper in love with someone. It's the latest released track. The use of the track is similar to "Love you with all my heart". Depending on the perspective of the perceiver, will it be positive or negative.

#### Distribution
```{r, echo=FALSE, fig.width=5, fig.height=4}
isaac_epi <- my_df %>% group_by(OST) %>% filter(artist  == "Isaac Hong")

ggplot(isaac_epi, aes(x=episode, fill=Valence)) +
  geom_histogram(bins=15) +
  labs(title = "Valence distribution over episodes",
       x = "Episodes",
       y = "Count") +
  scale_fill_manual(values = c("#73C6B6", "#229954", "#3498DB" ))
```

The track is only played in phase 3, progressing into the main plot of the drama. In phase 3 the scenes between the couple are guided by unreleased OST. Meaning that the data from Fallin' is incomplete and it may be insufficient to spot any pattern in the distribution. 



####  Correlation between segment and valence 

```{r, echo=FALSE, fig.width=5, fig.height=4}

new_isaac_epi <- isaac_epi %>% mutate(segment = case_when(end < 1500 ~ 'Begin',
                                                    end < 3400 ~ 'Central',
                                                    end < 6000 ~ 'End'))

ggplot(new_isaac_epi, aes(segment)) + geom_bar(aes(fill = Valence)) +
  labs(title = "Episode's segment and valence",
       x = "Segment",
       y = "Count") +
   scale_fill_manual(values = c("#73C6B6", "#229954", "#3498DB"))

```

The use of the track is determined by the ending track of the previous episode. This track used in the begin is the continuation of the conflicted end. This reasoning support the idea that the begin of an episode is concluded positively. 

## Column {style="min-width:600px"}

### Handcrafted data
I manually ran through all the episodes to create a data frame. This was necessary for linking the musical analysis with the drama.

- start = begin of the track in seconds
- end = end of the fragment in seconds

A preview

```{r echo=FALSE, fig.width=2, fig.height=3}
head(my_df)
```


### Spotify valence and energy plot

```{r echo=FALSE, fig.width=4, fig.height=4}

sort <- album %>% arrange(desc(valence))

ggplot(sort, aes(x=fct_inorder(track.name), y=valence, fill=energy)) +
  geom_bar(stat="identity") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Spotify valence and energy score on tracks",
       x = NULL,
       y = "Valence")
```

### Compare Spotify valence score


The energy score in Spotify signifies the perceptual measure of intensity and activity of a track. The energy feature suites really well with the prior analysis. The perception of the tracks in the drama.

The barplot above correlates very well with the track's individual analysis. "The reasons of my smiles" is frequently used for the most positive scenes and can be seen with the highest valence score. However the score seems rather low. This may be the result of the fairly neutral lyrics and low tempo of the track. On the contrary the energy score fits perfectly on the perceived experience of the track in the drama. The track is not too eventful and noisy. 

"Tell me it's not a dream" has surprisingly the lowest valence score even though the track is largely used for positive interactions. The cause for this particular score can be due to the chord progressions and timbre. 10CM's voice do give off melancholic timbre. In this case, the Spotify valence is missing contextual data of the drama, which misclassifies the valence score.

"Hold me back" is mainly used for the saddest parts. It is remarkable that the track is the second highest in valence. In comparison to the others tracks, Hold me back's lyrics are entirely Korean. I think Spotify has no translation algorithm to find out the lyrics valence. Also the BPM of Hold me back is the highest, meaning the activity of the track is relatively high. This could mean that the valence score is boosted by the energy, tempo and loudness scores.



# Chroma's {data-navmenu=Analysis data-orientation=rows}

## Row {style="min-height:1000px" .tabset .tabset-fade}

### The reasons of my smile

#### Chromagram

```{r, echo=FALSE, fig.width=15, fig.height=4}

# Get average time in seconds
avg_bss <- bss_epi %>% mutate(avg_len=end - start) %>% summarize(avg_duration=sum(avg_len)/7)

# Chrom
bss_chroma <-
  get_tidy_audio_analysis(s_1) |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches)

bss_chroma |>
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) |>
  compmus_gather_chroma() |> 
  ggplot(
    aes(
      x = start + duration/2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  theme_minimal() +
  scale_fill_viridis_c()+
  geom_vline(xintercept = 25, color = "green", size = 2) +
  geom_vline(xintercept = 60, color = "green", size = 2) +
  geom_vline(xintercept = 80, color = "green", size = 2) +
  geom_vline(xintercept = 110, color = "green", size = 2) +
  geom_vline(xintercept = 150, color = "green", size = 2) +
  geom_vline(xintercept = 200, color = "green", size = 2) + 
  annotate('text', x = 40, y = 6.5, label = '(Verse 1)', size=7, fontface="bold", color="orange", alpha=0.5) +
  annotate('text', x = 68, y = 6.5, label = '(Pre)', size=7, fontface="bold", color="orange", alpha=0.5) +
  annotate('text', x = 95, y = 6.5, label = '(Chorus 1)', size=7, fontface="bold", color="orange", alpha=0.5) +
  annotate('text', x = 130, y = 6.5, label = '(Verse 2)', size=7, fontface="bold", color="orange", alpha=0.5) +
  annotate('text', x = 175, y = 6.5, label = '(Chorus 2)', size=7, fontface="bold", color="orange", alpha=0.5) +
  geom_vline(xintercept = avg_bss$avg_duration , color = "red", size = 2) 

```

#### Chromo analysis
Judging by the differences in the segments, the track can be divided into an intro, verse, pre-chorus, chorus and ending. The parts are divided by the green vertical lines. The red line represents the average time of the "The reason of my smiles" being played in the drama. In general the track is being played from the intro to the average time. The second part of the track is not frequently used, because the emotional scenes don't last long. The heart throbbing effect loses its meaning when scenes are too long.

##### intro
The intro is longer than usual. Making the track's intro very distinct when played in the drama. The piano chords are clearly the focus in the intro. This intention is found in the chroma, where the magnitude is solely in the pitches F,G,A,C. This focus on the piano chords has another effect of presenting the signature melody, which are repeated in the following verse.

##### verse
It is slightly visible in the verse that it is sung, because of the overtones in the singing. The overtones creates a higher magnitude in the pitches, resulting in dark blue blotches decreasing in size. The melody and rythm of the verse stays the same as the intro. The only addition is a singing voice. 

##### pre-chorus
The pre-chorus is used to form a bridge to the chorus. In the chorus feels a bit faster, due to the sudden addition of low frequency beats. In order to transition from a slow paced verse to a faster paced chorus, the writer added a pre-chorus. The same pitches are being played, but faster. Just right before the chorus segment the pre-chorus pitches vanishes. This drop can be seen in the B-G region, the main pitches for the melody, where the magnitude is very dark.  

##### chorus
The chorus has an overall higher magnitude, resulting in a a greener segment. This magnitude is caused by louder singing, section sung in falsetto and higher pitches and the faster paced rythm. The main melody is still visible in the chorus. The reason for the chorus 2 to be larger is because half of the chorus is the post-chorus. This post-chorus is included in the sheet music, but discerning the post-chorus in the chroma proved to be difficult. Also the post-chorus is not used in the drama, which makes it irrelevant.

#### Usages
Only the intro, verse 1 and pre-chorus are used for the background music. It is likely that the chorus is too noisy for heartwarming scenes. The chorus feels as having a higher tempo, which is undesirable when the drama wants to zoom into the facial expressions of the protagonist.

### Tell me it's not a dream

#### Chromogram

```{r, echo=FALSE, fig.width=15, fig.height=4}

avg_cm <- cm_epi %>% mutate(avg_len=end - start) %>% summarize(avg_duration=sum(avg_len)/6)

cm_chroma <-
  get_tidy_audio_analysis(s_2) |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches)

cm_chroma |>
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) |>
  compmus_gather_chroma() |> 
  ggplot(
    aes(
      x = start + duration/2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  theme_minimal() +
  scale_fill_viridis_c() +
  geom_vline(xintercept = 10, color = "green", size = 2) +
  geom_vline(xintercept = 60, color = "green", size = 2) +
  geom_vline(xintercept = 150, color = "green", size = 2) +
  geom_vline(xintercept = 100, color = "green", size = 2) + 
  geom_vline(xintercept = 225, color = "green", size = 2) + 

  annotate('text', x = 35, y = 6.5, label = '(Verse 1)', size=7, fontface="bold", color="orange", alpha=0.5) +
  annotate('text', x = 80, y = 6.5, label = '(Chorus 1)', size=7, fontface="bold", color="orange", alpha=0.5) +
  annotate('text', x = 125, y = 6.5, label = '(Verse 2)', size=7, fontface="bold", color="orange", alpha=0.5) +
  annotate('text', x = 190, y = 6.5, label = '(Chorus 2)', size=7, fontface="bold", color="orange", alpha=0.5) +
  
  geom_vline(xintercept = avg_cm$avg_duration , color = "red", size = 2) 

```

#### Chromo analysis
The parts are divided by the green vertical lines. The red line represents the average time of the "Tell me it's not a dream" being played in the drama. In general the track is being played from the intro to the average time. In contrast to "My reason of my smiles" is this track's intro not mention worthy. It has no significant use, than setting up the track. The centre of attention is steered into the chorus and verses. 

##### Verse 1
Verse 1 is played with a guitar bass. The bass pattern is apparent in the D/C# pitches through the magnitude blocks. Showing the skeleton of the track. The guitar bass accompanied with singing are the highlights of the verse. There is no clear indication of multiple vocals. It seems that the singing of 10CM is relatively the same over the whole track, resulting in a homogeneous spread of intensities. 

##### Chorus 1
The drums are added in chorus 1. This addition increases the Inharmonicity, which in turn slightly increases the segment's magnitudes. The melodic bass pattern is also apparent in the chorus, continuing to improve the feeling of familiarity.

##### Verse 2 
In verse 2 the guitar bass disappears and is replaced with a piano playing the same pitches. The block pattern is still visible with some imagination. The magnitudes are constantly changing. This may be due to the ADSR of the piano, which has a fast release phase. Creating more nuances in the pitch magnitudes. The change in timbre is evident even though the chromagram is oriented around structural analysis.

#### Usages
Only verse 1 and a single use of the chorus has been observed in the drama to convey positive emotions. There is no clear structural reason for the usage. 

### Hold me back

#### Chromagram

```{r, echo=FALSE, fig.width=15, fig.height=4}

avg_heize <- heize_epi %>% mutate(avg_len=end - start) %>% summarize(avg_duration=sum(avg_len)/5)

heize_chroma <-
  get_tidy_audio_analysis(s_3) |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches)

heize_chroma |>
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) |>
  compmus_gather_chroma() |> 
  ggplot(
    aes(
      x = start + duration/2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  theme_minimal() +
  scale_fill_viridis_c() +
  geom_vline(xintercept = avg_heize$avg_duration , color = "red", size = 2) +
  geom_vline(xintercept = 60, color = "green", size = 2) +
  geom_vline(xintercept = 98, color = "green", size = 2) +
  geom_vline(xintercept = 135, color = "green", size = 2) +
  
  annotate('text', x = 35, y = 6.5, label = '(Verse 1)', size=7, fontface="bold", color="orange", alpha=0.5) +
  annotate('text', x = 80, y = 6.5, label = '(Chorus 1)', size=7, fontface="bold", color="orange", alpha=0.5) +
  annotate('text', x = 120, y = 6.5, label = '(Verse 2)', size=7, fontface="bold", color="orange", alpha=0.5) +
  annotate('text', x = 180, y = 6.5, label = '(Chorus 2)', size=7, fontface="bold", color="orange", alpha=0.5)
```

#### Chromo analysis
It's observable that the scale used is C,B,A,B,F,D# and D, because the pitch magnitudes are concentrated on horizontal axis. The spacing in the pitches is very similar to the piano part in "Tell me it's not a dream" and in fact the track is mainly played with piano. This track's chromagram has no obvious patterns, the magnitudes are all over the place. Hinting towards a high tempo track. 

#### Usages 
Verse 1 + chorus 1 are largely used for sad and conflicting scenes. In half of cases is the verse 2 added to prolong the heartbreaking moments. "Hold me back" has one of the longest average time. This supports the idea that sad moments are longer than the happy counter parts. Since the viewer wants to feel more happy than sad, the drama slows down the track's tempo on these scenes. While in the sad parts, the drama increases the tempo to make it feel shorter than actual is. The sad scenes need to be longer to evoke the maximum amount of tension.

### Crush

#### Chromogram


```{r, echo=FALSE, fig.width=15, fig.height=4}

avg_crush <- crush_epi %>% mutate(avg_len=end - start) %>% summarize(avg_duration=sum(avg_len)/4)


crush_chroma <-
  get_tidy_audio_analysis(s_4) |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches)

crush_chroma |>
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) |>
  compmus_gather_chroma() |> 
  ggplot(
    aes(
      x = start + duration/2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  theme_minimal() +
  scale_fill_viridis_c() +
  geom_vline(xintercept = avg_crush$avg_duration , color = "red", size = 2) +
  geom_vline(xintercept = 10, color = "green", size = 2) +
  geom_vline(xintercept = 60, color = "green", size = 2) +
  geom_vline(xintercept = 160, color = "green", size = 2) +
  geom_vline(xintercept = 220, color = "green", size = 2) +
  geom_vline(xintercept = 120, color = "green", size = 2) +
  
  annotate('text', x = 35, y = 6.5, label = '(Verse 1)', size=7, fontface="bold", color="orange", alpha=0.5) +
  annotate('text', x = 90, y = 6.5, label = '(Chorus 1)', size=7, fontface="bold", color="orange", alpha=0.5) +
  annotate('text', x = 140, y = 6.5, label = '(Verse 2)', size=7, fontface="bold", color="orange", alpha=0.5) +
  annotate('text', x = 190, y = 6.5, label = '(Chorus 2)', size=7, fontface="bold", color="orange", alpha=0.5)
  

```

#### Chromo analysis


#### Usages

### Isaac

#### Chromogram

```{r, echo=FALSE, fig.width=15, fig.height=4}

avg_isaac <- isaac_epi %>% mutate(avg_len=end - start) %>% summarize(avg_duration=sum(avg_len)/4)

isaac_chroma <-
  get_tidy_audio_analysis(s_5) |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches)

isaac_chroma |>
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) |>
  compmus_gather_chroma() |> 
  ggplot(
    aes(
      x = start + duration/2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  theme_minimal() +
  scale_fill_viridis_c() +
  geom_vline(xintercept = avg_isaac$avg_duration , color = "red", size = 2) 

```

#### Chromo analysis



# Conclusion